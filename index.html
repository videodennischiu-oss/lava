<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ÁÅ´Â±±Ë∑≥Ë∫ç | Volcano Jump</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:#0a0005;display:flex;justify-content:center;
  align-items:center;height:100vh;overflow:hidden;font-family:'Cinzel',serif;
}
#game-container{position:relative;width:420px;height:748px;}
canvas{display:block;}

#ui-overlay{
  position:absolute;top:0;left:0;right:0;bottom:0;
  pointer-events:none;z-index:10;
}

/* Lang */
#lang-btn{
  position:absolute;top:16px;right:16px;pointer-events:all;
  background:linear-gradient(145deg,#1c0500,#4a1000);
  border:2px solid #ff6b00;color:#ffd700;
  font-family:'Cinzel',serif;font-size:12px;font-weight:700;
  letter-spacing:1.5px;padding:8px 18px;border-radius:30px;cursor:pointer;
  box-shadow:0 0 14px rgba(255,100,0,.55),0 4px 14px rgba(0,0,0,.7),
             inset 0 1px 0 rgba(255,190,80,.35);
  text-shadow:0 0 8px rgba(255,160,0,.9);transition:all .2s;
}
#lang-btn:hover{background:linear-gradient(145deg,#2e0800,#6e1d00);transform:translateY(-1px);}

/* Score */
#score-display{position:absolute;top:16px;left:16px;display:none;pointer-events:none;}
#score-label{color:rgba(255,160,80,.65);font-size:10px;letter-spacing:3px;text-transform:uppercase;}
#score-value{
  color:#ffd700;font-family:'Cinzel Decorative',cursive;
  font-size:30px;font-weight:900;line-height:1;
  text-shadow:0 0 12px rgba(255,200,0,.85),2px 2px 4px rgba(0,0,0,.9);
}

/* Power-up status bar */
#powerup-bar{
  position:absolute;top:70px;left:16px;display:none;pointer-events:none;
}
.pu-item{
  display:flex;align-items:center;gap:6px;
  margin-bottom:5px;
}
.pu-icon{font-size:18px;filter:drop-shadow(0 0 4px rgba(255,200,0,.8));}
.pu-timer{
  background:rgba(0,0,0,.55);border-radius:20px;
  width:80px;height:8px;overflow:hidden;
  border:1px solid rgba(255,180,0,.4);
}
.pu-timer-fill{
  height:100%;border-radius:20px;transition:width .1s;
}
#wing-bar .pu-timer-fill{background:linear-gradient(90deg,#00ccff,#88eeff);}
#sub-bar .pu-timer-fill{background:linear-gradient(90deg,#00ff99,#00ffcc);}

/* Sub HUD */
#sub-hud{
  position:absolute;bottom:180px;left:50%;transform:translateX(-50%);
  display:none;pointer-events:all;
  text-align:center;
}
#sub-oxygen{
  color:#00ffcc;font-family:'Cinzel Decorative',cursive;
  font-size:11px;letter-spacing:3px;margin-bottom:6px;
  text-shadow:0 0 10px rgba(0,255,200,.6);
}
#sub-exit-btn{
  background:linear-gradient(145deg,#001a10,#003828);
  border:2px solid #00ffcc;color:#00ffcc;
  font-family:'Cinzel',serif;font-size:12px;font-weight:700;
  letter-spacing:2px;padding:8px 22px;border-radius:30px;cursor:pointer;
  box-shadow:0 0 14px rgba(0,255,180,.4),inset 0 1px 0 rgba(0,255,200,.2);
  text-shadow:0 0 8px rgba(0,255,180,.8);transition:all .2s;pointer-events:all;
}
#sub-exit-btn:hover,#sub-exit-btn:active{
  background:linear-gradient(145deg,#003020,#006040);
  box-shadow:0 0 24px rgba(0,255,180,.7);transform:translateY(-1px);
}

/* Menu */
#menu-screen{
  position:absolute;top:0;left:0;right:0;bottom:0;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  pointer-events:all;
  background:radial-gradient(ellipse at center 80%,rgba(220,50,0,.28) 0%,transparent 65%);
}
.menu-subtitle{color:#ff6b00;font-size:11px;letter-spacing:6px;text-transform:uppercase;
  text-shadow:0 0 10px rgba(255,100,0,.6);margin-bottom:10px;}
.menu-title{
  color:#ffd700;font-family:'Cinzel Decorative',cursive;
  font-size:38px;font-weight:900;line-height:1.1;text-align:center;
  text-shadow:0 0 22px rgba(255,150,0,.95),0 0 55px rgba(255,50,0,.55),3px 3px 7px rgba(0,0,0,.95);
  margin-bottom:16px;animation:titlePulse 2.2s ease-in-out infinite;
}
@keyframes titlePulse{
  0%,100%{text-shadow:0 0 22px rgba(255,150,0,.95),0 0 55px rgba(255,50,0,.5),3px 3px 7px rgba(0,0,0,.95)}
  50%{text-shadow:0 0 35px rgba(255,210,0,1),0 0 90px rgba(255,100,0,.85),3px 3px 7px rgba(0,0,0,.95)}
}
.menu-legend{
  display:flex;gap:20px;margin-bottom:40px;flex-wrap:wrap;justify-content:center;
}
.legend-item{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  background:rgba(0,0,0,.4);border:1px solid rgba(255,100,0,.25);
  border-radius:12px;padding:8px 12px;
}
.legend-icon{font-size:22px;}
.legend-text{color:rgba(255,180,100,.7);font-size:9px;letter-spacing:1px;text-align:center;max-width:70px;}

.luxury-btn{
  position:relative;overflow:hidden;
  background:linear-gradient(160deg,#2a0800,#5c1400,#1e0500);
  border:none;border-radius:50px;padding:18px 65px;cursor:pointer;
  box-shadow:0 0 0 2px rgba(255,100,0,.65),0 10px 36px rgba(0,0,0,.75),
             inset 0 1.5px 0 rgba(255,185,80,.35),inset 0 -2px 0 rgba(0,0,0,.55);
  transition:all .25s;
}
.luxury-btn::before{
  content:'';position:absolute;top:0;left:-120%;width:80%;height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,210,120,.18),transparent);
  transition:left .55s;
}
.luxury-btn:hover::before,.luxury-btn:active::before{left:130%;}
.luxury-btn:hover,.luxury-btn:active{
  transform:translateY(-3px);
  box-shadow:0 0 0 2.5px rgba(255,165,0,.95),0 18px 45px rgba(0,0,0,.85),
             0 0 70px rgba(255,110,0,.45),inset 0 1.5px 0 rgba(255,210,120,.4);
}
.btn-text{
  color:#ffd700;font-family:'Cinzel Decorative',cursive;
  font-size:18px;font-weight:700;letter-spacing:2px;
  text-shadow:0 0 12px rgba(255,205,0,.85),1px 1px 3px rgba(0,0,0,.95);
  position:relative;z-index:1;
}
.menu-hint{
  margin-top:28px;color:rgba(255,150,80,.45);font-size:11px;letter-spacing:2px;
  animation:blink 2s ease-in-out infinite;
}
@keyframes blink{0%,100%{opacity:.25}50%{opacity:.7}}

/* Game Over */
#gameover-screen{
  position:absolute;top:0;left:0;right:0;bottom:0;
  display:none;flex-direction:column;align-items:center;justify-content:center;
  pointer-events:all;background:rgba(0,0,0,.72);backdrop-filter:blur(5px);
}
.gameover-panel{
  background:linear-gradient(145deg,rgba(28,5,0,.97),rgba(8,0,0,.97));
  border:2px solid rgba(255,75,0,.45);border-radius:26px;
  padding:36px 44px;text-align:center;
  box-shadow:0 0 45px rgba(255,45,0,.28),0 22px 65px rgba(0,0,0,.85);
  width:82%;max-width:320px;
}
.gameover-title{
  color:#ff3300;font-family:'Cinzel Decorative',cursive;
  font-size:24px;font-weight:900;margin-bottom:5px;
  text-shadow:0 0 22px rgba(255,45,0,.85);
}
.go-score-label{color:rgba(255,148,78,.55);font-size:10px;letter-spacing:4px;margin-top:18px;margin-bottom:4px;}
.go-score{
  color:#ffd700;font-family:'Cinzel Decorative',cursive;
  font-size:48px;font-weight:900;line-height:1;
  text-shadow:0 0 22px rgba(255,205,0,.75);
}
.go-best-label{color:rgba(255,148,78,.55);font-size:10px;letter-spacing:3px;margin-top:8px;margin-bottom:4px;}
.go-best{color:#ff9944;font-family:'Cinzel Decorative',cursive;font-size:22px;margin-bottom:28px;}
.retry-btn{
  background:linear-gradient(145deg,#1a0500,#5c1800);border:none;
  border-radius:40px;padding:14px 40px;cursor:pointer;width:100%;
  box-shadow:0 0 0 2px rgba(255,115,0,.5),0 6px 22px rgba(0,0,0,.65);
  transition:all .2s;margin-bottom:10px;
}
.retry-btn:hover,.retry-btn:active{
  transform:translateY(-2px);
  box-shadow:0 0 0 2.5px rgba(255,185,0,.85),0 0 35px rgba(255,95,0,.35);
}
.back-btn{
  background:transparent;border:none;border-radius:40px;
  padding:10px 30px;cursor:pointer;width:100%;
  box-shadow:0 0 0 1px rgba(255,75,0,.28);transition:all .2s;
}
.back-btn:hover,.back-btn:active{background:rgba(255,75,0,.1);}
.btn-sm-text{color:rgba(255,195,100,.65);font-family:'Cinzel',serif;font-size:13px;letter-spacing:2px;}

/* Danger flash */
#danger-flash{
  position:absolute;top:0;left:0;right:0;bottom:0;
  pointer-events:none;background:rgba(255,50,0,0);transition:background .15s;
}
/* Sub flash */
#sub-flash{
  position:absolute;top:0;left:0;right:0;bottom:0;
  pointer-events:none;background:rgba(0,255,180,0);transition:background .3s;
}

/* Touch controls */
#touch-controls{
  position:absolute;bottom:0;left:0;right:0;height:160px;
  display:none;pointer-events:none;z-index:5;
}
.touch-zone{
  position:absolute;bottom:0;height:160px;width:50%;
  pointer-events:all;display:flex;align-items:center;justify-content:center;
}
#zone-left{left:0;}
#zone-right{right:0;}
.arrow-btn{
  width:72px;height:72px;border-radius:50%;
  background:linear-gradient(145deg,rgba(30,5,0,0.75),rgba(80,20,0,0.75));
  border:2px solid rgba(255,120,0,0.55);
  box-shadow:0 0 18px rgba(255,80,0,0.35),inset 0 1px 0 rgba(255,180,80,0.25);
  display:flex;align-items:center;justify-content:center;
  backdrop-filter:blur(4px);transition:all .1s;
  user-select:none;-webkit-user-select:none;
}
.arrow-btn svg{width:32px;height:32px;}
.arrow-btn.pressed{
  background:linear-gradient(145deg,rgba(80,20,0,0.9),rgba(160,50,0,0.9));
  border-color:rgba(255,180,0,0.85);
  box-shadow:0 0 28px rgba(255,130,0,0.65);transform:scale(0.93);
}
#jump-hint{
  position:absolute;bottom:168px;left:50%;transform:translateX(-50%);
  color:rgba(255,160,80,0.38);font-size:10px;letter-spacing:2px;
  pointer-events:none;white-space:nowrap;
}
</style>
</head>
<body>
<div id="game-container">
  <div id="ui-overlay">
    <div id="score-display">
      <div id="score-label">HEIGHT</div>
      <div id="score-value">0</div>
    </div>
    <div id="powerup-bar">
      <div class="pu-item" id="wing-bar" style="display:none">
        <span class="pu-icon">ü™∂</span>
        <div class="pu-timer"><div class="pu-timer-fill" id="wing-fill" style="width:100%"></div></div>
      </div>
      <div class="pu-item" id="sub-bar" style="display:none">
        <span class="pu-icon">ü´ß</span>
        <div class="pu-timer"><div class="pu-timer-fill" id="sub-fill" style="width:100%"></div></div>
      </div>
    </div>
    <button id="lang-btn">EN / ‰∏≠</button>
    <div id="danger-flash"></div>
    <div id="sub-flash"></div>

    <!-- ÊΩõËâáÂÄâ HUD -->
    <div id="sub-hud">
      <div id="sub-oxygen">‚¨§‚¨§‚¨§‚¨§‚¨§ O‚ÇÇ</div>
      <button id="sub-exit-btn" id="txt-sub-exit">EJECT</button>
    </div>

    <!-- Touch Controls -->
    <div id="touch-controls">
      <div class="touch-zone" id="zone-left">
        <div class="arrow-btn" id="btn-left">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M15 6L9 12L15 18" stroke="#ffd700" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <div class="touch-zone" id="zone-right">
        <div class="arrow-btn" id="btn-right">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M9 6L15 12L9 18" stroke="#ffd700" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </div>
    <div id="jump-hint" style="display:none"></div>

    <!-- Menu -->
    <div id="menu-screen">
      <div class="menu-subtitle" id="txt-subtitle">ESCAPE THE INFERNO</div>
      <div class="menu-title" id="txt-title">VOLCANO<br>JUMP</div>
      <div class="menu-legend">
        <div class="legend-item"><span class="legend-icon">ü™∂</span><span class="legend-text" id="leg-wing">WINGS ¬∑ FLY FREE</span></div>
        <div class="legend-item"><span class="legend-icon">üíé</span><span class="legend-text" id="leg-gem">GEM ¬∑ +50 PTS</span></div>
        <div class="legend-item"><span class="legend-icon">üöÄ</span><span class="legend-text" id="leg-sub">CAPSULE ¬∑ LAVA SAFE</span></div>
        <div class="legend-item"><span class="legend-icon">ü¶á</span><span class="legend-text" id="leg-bat">BAT ¬∑ KNOCKBACK</span></div>
        <div class="legend-item"><span class="legend-icon">üî•</span><span class="legend-text" id="leg-rock">BOULDER ¬∑ HEAVY HIT</span></div>
      </div>
      <button class="luxury-btn" id="start-btn">
        <span class="btn-text" id="txt-start">PLAY</span>
      </button>
      <div class="menu-hint" id="txt-hint">TAP TOP = JUMP ¬∑ ‚Üê ‚Üí = MOVE</div>
    </div>

    <!-- Game Over -->
    <div id="gameover-screen">
      <div class="gameover-panel">
        <div class="gameover-title" id="txt-gameover">CONSUMED</div>
        <div class="go-score-label" id="txt-score-label">ALTITUDE</div>
        <div class="go-score" id="final-score">0</div>
        <div class="go-best-label" id="txt-best-label">BEST</div>
        <div class="go-best" id="best-score">0</div>
        <button class="retry-btn" id="retry-btn">
          <span class="btn-text" id="txt-retry">RISE AGAIN</span>
        </button>
        <button class="back-btn" id="menu-btn-go">
          <span class="btn-sm-text" id="txt-menu">MENU</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê i18n ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const T={
  en:{
    subtitle:'ESCAPE THE INFERNO',title:'VOLCANO<br>JUMP',
    start:'PLAY',hint:'TAP TOP = JUMP ¬∑ ‚Üê ‚Üí = MOVE',
    gameover:'CONSUMED',scoreLabel:'ALTITUDE',bestLabel:'BEST',
    retry:'RISE AGAIN',menu:'MENU',hud:'HEIGHT',
    jumpHint:'TAP UPPER SCREEN TO JUMP',
    subExit:'EJECT NOW',
    legWing:'WINGS ¬∑ FLY FREE',legGem:'GEM ¬∑ +50 PTS',
    legSub:'CAPSULE ¬∑ LAVA SAFE',legBat:'BAT ¬∑ KNOCKBACK',legRock:'BOULDER ¬∑ HEAVY HIT',
  },
  zh:{
    subtitle:'ÈÄÉÈõ¢ÁÅ´ÁÑ∞Ê∑±Ê∑µ',title:'ÁÅ´Â±±<br>Ë∑≥Ë∫ç',
    start:'ÈñãÂßãÈÅäÊà≤',hint:'Èªû‰∏äÊñπË∑≥Ë∫ç ¬∑ Â∑¶Âè≥ÈçµÁßªÂãï',
    gameover:'Ëë¨Ë∫´ÁÅ´Êµ∑',scoreLabel:'È´òÂ∫¶',bestLabel:'ÊúÄ‰Ω≥',
    retry:'ÂÜçÊ¨°ÊåëÊà∞',menu:'ÈÅ∏ÂñÆ',hud:'È´òÂ∫¶',
    jumpHint:'ÈªûÊìä‰∏äÊñπÁï´Èù¢Ë∑≥Ë∫ç',
    subExit:'Á∑äÊÄ•ÂΩàÂ∞Ñ',
    legWing:'ÁøÖËÜÄ ¬∑ Ëá™Áî±È£õÁøî',legGem:'ÂØ∂Áü≥ ¬∑ +50ÂàÜ',
    legSub:'ÊΩõËâáÂÄâ ¬∑ Â≤©Êºø‰øùË≠∑',legBat:'ÁÅ´Ëù† ¬∑ ÊìäÈÄÄ',legRock:'ÁÜîÂ≤©Áü≥ ¬∑ ÈáçÊìä',
  },
};
let lang='en';
function applyLang(){
  const t=T[lang];
  document.getElementById('txt-subtitle').textContent=t.subtitle;
  document.getElementById('txt-title').innerHTML=t.title;
  document.getElementById('txt-start').textContent=t.start;
  document.getElementById('txt-hint').textContent=t.hint;
  document.getElementById('txt-gameover').textContent=t.gameover;
  document.getElementById('txt-score-label').textContent=t.scoreLabel;
  document.getElementById('txt-best-label').textContent=t.bestLabel;
  document.getElementById('txt-retry').textContent=t.retry;
  document.getElementById('txt-menu').textContent=t.menu;
  document.getElementById('score-label').textContent=t.hud;
  document.getElementById('sub-exit-btn').textContent=t.subExit;
  const jh=document.getElementById('jump-hint'); if(jh) jh.textContent=t.jumpHint;
  document.getElementById('leg-wing').textContent=t.legWing;
  document.getElementById('leg-gem').textContent=t.legGem;
  document.getElementById('leg-sub').textContent=t.legSub;
  document.getElementById('leg-bat').textContent=t.legBat;
  document.getElementById('leg-rock').textContent=t.legRock;
}
document.getElementById('lang-btn').addEventListener('click',()=>{ lang=lang==='en'?'zh':'en'; applyLang(); });
applyLang();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BGM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let bgm=null,bgmReady=false,gameStarted=false;
(function(){
  try{
    const a=new Audio();
    a.loop=true; a.volume=0.42;
    a.addEventListener('canplaythrough',()=>{ bgmReady=true; },{once:true});
    a.addEventListener('error',()=>{ bgmReady=false; },{once:true});
    a.src='bgm.mp3'; bgm=a;
  }catch(e){}
})();
function playBGM(){ if(bgm&&bgmReady) bgm.play().catch(()=>{}); }
function pauseBGM(){ if(bgm) bgm.pause(); }
function stopBGM(){ if(bgm){ bgm.pause(); bgm.currentTime=0; } }
document.addEventListener('visibilitychange',()=>{ if(document.hidden) pauseBGM(); else if(gameStarted) playBGM(); });
window.addEventListener('pagehide',stopBGM);
window.addEventListener('beforeunload',stopBGM);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Phaser ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const GW=420,GH=748;
let bestScore=0,phaserGame=null;

// Floating text popup helper (screen coords)
function showFloatText(scene, x, y, txt, color=0xffd700){
  const screenX = x - scene.cameras.main.scrollX;
  const screenY = y - scene.cameras.main.scrollY;
  const t = scene.add.text(screenX, screenY, txt, {
    fontFamily:'Cinzel Decorative',fontSize:'22px',
    color:'#'+color.toString(16).padStart(6,'0'),
    stroke:'#000',strokeThickness:4,
  }).setScrollFactor(0).setDepth(20).setOrigin(0.5,1);
  scene.tweens.add({
    targets:t, y:screenY-60, alpha:0, duration:900, ease:'Cubic.Out',
    onComplete:()=>t.destroy(),
  });
}

class GameScene extends Phaser.Scene {
  constructor(){ super({key:'GameScene'}); }

  /* ‚îÄ‚îÄ Textures ‚îÄ‚îÄ */
  makeTextures(){
    // Player normal
    if(!this.textures.exists('player')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0xff4400); g.fillRoundedRect(8,12,20,22,6);
      g.fillStyle(0xffcc88); g.fillCircle(18,9,10);
      g.fillStyle(0x220000); g.fillCircle(14,8,2.5); g.fillCircle(22,8,2.5);
      g.fillStyle(0xffffff,0.35); g.fillCircle(13,6,1.2); g.fillCircle(21,6,1.2);
      g.fillStyle(0xff6600); g.fillTriangle(10,2,15,2,12,-8); g.fillTriangle(21,2,26,2,24,-8);
      g.fillStyle(0xcc2200); g.fillRect(10,32,7,10); g.fillRect(19,32,7,10);
      g.generateTexture('player',36,44); g.destroy();
    }
    // Player winged (blue glow tint)
    if(!this.textures.exists('player_wing')){
      const g=this.make.graphics({add:false});
      // wings
      g.fillStyle(0x44aaff,0.85);
      g.fillEllipse(2,20,22,14);  g.fillEllipse(34,20,22,14);
      g.fillStyle(0xaaddff,0.5);
      g.fillEllipse(0,18,14,8); g.fillEllipse(36,18,14,8);
      // body copy
      g.fillStyle(0xff6600); g.fillRoundedRect(8,12,20,22,6);
      g.fillStyle(0xffcc88); g.fillCircle(18,9,10);
      g.fillStyle(0x220000); g.fillCircle(14,8,2.5); g.fillCircle(22,8,2.5);
      g.fillStyle(0xff6600); g.fillTriangle(10,2,15,2,12,-8); g.fillTriangle(21,2,26,2,24,-8);
      g.fillStyle(0xcc2200); g.fillRect(10,32,7,10); g.fillRect(19,32,7,10);
      g.generateTexture('player_wing',40,44); g.destroy();
    }
    // Platform
    if(!this.textures.exists('plat_base')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0x000000,0.4); g.fillRoundedRect(3,4,100,18,6);
      g.fillGradientStyle(0x8b2200,0x5c1200,0x6b1800,0x3d0a00,1);
      g.fillRoundedRect(0,0,100,18,6);
      g.fillStyle(0xff8800,0.5); g.fillRoundedRect(3,2,94,4,3);
      g.generateTexture('plat_base',104,23); g.destroy();
    }
    // Bat (obstacle)
    if(!this.textures.exists('bat')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0xaa0044);
      // wings
      g.fillEllipse(4,14,20,10); g.fillEllipse(36,14,20,10);
      // wing tips
      g.fillTriangle(0,10,8,20,0,22); g.fillTriangle(40,10,32,20,40,22);
      // body
      g.fillStyle(0x660022); g.fillCircle(20,16,9);
      // eyes
      g.fillStyle(0xff0055); g.fillCircle(17,13,3); g.fillCircle(23,13,3);
      g.fillStyle(0xffff00); g.fillCircle(17,13,1.5); g.fillCircle(23,13,1.5);
      g.generateTexture('bat',44,28); g.destroy();
    }
    // Boulder (obstacle)
    if(!this.textures.exists('boulder')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0x992200); g.fillCircle(16,16,16);
      g.fillStyle(0xcc3300,0.6); g.fillCircle(10,10,8);
      g.fillStyle(0xff6600,0.4); g.fillCircle(8,8,4);
      g.fillStyle(0x550000,0.5); g.fillCircle(22,20,5);
      g.generateTexture('boulder',32,32); g.destroy();
    }
    // Wing pickup
    if(!this.textures.exists('pickup_wing')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0x00ccff,0.9);
      g.fillEllipse(6,16,18,24);
      g.fillStyle(0x88eeff,0.7);
      g.fillEllipse(4,14,10,18);
      g.fillStyle(0xffffff,0.5); g.fillEllipse(5,12,5,8);
      // mirror
      g.fillStyle(0x00ccff,0.9); g.fillEllipse(26,16,18,24);
      g.fillStyle(0x88eeff,0.7); g.fillEllipse(28,14,10,18);
      g.fillStyle(0xffffff,0.5); g.fillEllipse(27,12,5,8);
      g.generateTexture('pickup_wing',34,32); g.destroy();
    }
    // Gem pickup
    if(!this.textures.exists('pickup_gem')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0xffd700);
      g.fillTriangle(12,0,24,0,28,12);
      g.fillTriangle(0,12,28,12,14,28);
      g.fillTriangle(12,0,0,12,14,28);
      g.fillStyle(0xffffff,0.4); g.fillTriangle(13,2,22,2,26,10);
      g.generateTexture('pickup_gem',28,28); g.destroy();
    }
    // Submarine capsule
    if(!this.textures.exists('submarine')){
      const g=this.make.graphics({add:false});
      // hull
      g.fillStyle(0x004488);
      g.fillRoundedRect(0,8,56,28,10);
      // dome
      g.fillStyle(0x0066bb);
      g.fillEllipse(28,8,36,22);
      // window
      g.fillStyle(0x00ccff,0.7); g.fillCircle(28,14,8);
      g.fillStyle(0x88eeff,0.4); g.fillCircle(25,11,4);
      // rivets
      g.fillStyle(0x88bbdd);
      for(let i=0;i<4;i++){ g.fillCircle(8+i*14,34,2.5); }
      // propeller
      g.fillStyle(0x0099cc);
      g.fillEllipse(4,22,8,20); g.fillEllipse(4,22,20,8);
      g.generateTexture('submarine',58,40); g.destroy();
    }
    // Player inside submarine
    if(!this.textures.exists('player_sub')){
      const g=this.make.graphics({add:false});
      g.fillStyle(0x004488); g.fillRoundedRect(0,8,56,28,10);
      g.fillStyle(0x0066bb); g.fillEllipse(28,8,36,22);
      g.fillStyle(0x00ccff,0.5); g.fillCircle(28,14,8);
      // tiny player inside
      g.fillStyle(0xffcc88); g.fillCircle(28,13,5);
      g.fillStyle(0x220000); g.fillCircle(26,12,1.5); g.fillCircle(30,12,1.5);
      g.fillStyle(0x88bbdd);
      for(let i=0;i<4;i++){ g.fillCircle(8+i*14,34,2.5); }
      g.fillStyle(0x0099cc); g.fillEllipse(4,22,8,20); g.fillEllipse(4,22,20,8);
      g.generateTexture('player_sub',58,40); g.destroy();
    }
  }

  makePlatTex(w){
    const key='plat'+w;
    if(this.textures.exists(key)) return key;
    const g=this.make.graphics({add:false});
    g.fillStyle(0x000000,0.4); g.fillRoundedRect(3,4,w,18,6);
    g.fillGradientStyle(0x8b2200,0x5c1200,0x6b1800,0x3d0a00,1);
    g.fillRoundedRect(0,0,w,18,6);
    g.fillStyle(0xff8800,0.5); g.fillRoundedRect(3,2,w-6,4,3);
    g.fillStyle(0xff4400,0.7);
    const s=Math.floor(w/5); for(let i=1;i<5;i++) g.fillCircle(i*s,14,2);
    g.generateTexture(key,w+4,23); g.destroy();
    return key;
  }

  /* ‚îÄ‚îÄ create ‚îÄ‚îÄ */
  create(){
    this.score=0; this.alive=true;
    this.lavaWave=0; this.emberTimer=0; this.embers=[];

    // Power-up states
    this.wingActive=false; this.wingTimer=0; this.WING_DUR=6000;
    this.subActive=false;  this.subTimer=0;  this.SUB_DUR=5000;
    this.stunTimer=0;

    // Obstacle spawn tracking
    this.lastObstacleY=GH-400;
    this.lastPickupY=GH-300;
    this.lastSubY=GH-800;

    this.makeTextures();
    this.physics.world.setBounds(0,-200000,GW,200000+GH);

    // Background
    const bg=this.add.graphics();
    bg.fillGradientStyle(0x050002,0x050002,0x140100,0x140100,1);
    bg.fillRect(0,-200000,GW,200000+GH);
    bg.setScrollFactor(0.12);
    const rl=this.add.graphics().setScrollFactor(0.2);
    for(let y=-200000;y<GH;y+=650){ rl.fillStyle(0x1a0205,0.3); rl.fillRect(0,y,GW,6); }

    this.emberGfx=this.add.graphics().setScrollFactor(0).setDepth(8);

    // Platforms
    this.platforms=this.physics.add.staticGroup();
    this.highestY=GH-90;
    this.addPlat(GW/2,GH-75,180);
    for(let i=0;i<16;i++){
      this.highestY-=Phaser.Math.Between(85,145);
      this.addPlat(Phaser.Math.Between(55,GW-55),this.highestY,Phaser.Math.Between(65,135));
    }

    // Obstacles group (bats + boulders)
    this.obstacles=this.physics.add.group();
    // Pickups group (wings + gems + submarine)
    this.pickups=this.physics.add.group();

    // Player
    this.player=this.physics.add.sprite(GW/2,GH-160,'player');
    this.player.setCollideWorldBounds(false).setDepth(10);
    this.player.body.maxVelocity.y=1000;
    this.player.body.setGravityY(600);

    // Colliders
    this.physics.add.collider(this.player,this.platforms,(pl)=>{
      if(!this.subActive && pl.body.velocity.y>0) this.jump();
    });
    // Obstacle overlap
    this.physics.add.overlap(this.player,this.obstacles,(pl,obs)=>{
      this.hitObstacle(obs);
    });
    // Pickup overlap
    this.physics.add.overlap(this.player,this.pickups,(pl,pk)=>{
      this.collectPickup(pk);
    });

    // Lava
    this.lavaWorldY=GH+90; this.lavaSpd=30;
    this.lavaGfx=this.add.graphics().setScrollFactor(0).setDepth(6);
    this.add.rectangle(GW/2,GH+55,GW,110,0xaa0000).setScrollFactor(0).setDepth(6);

    // Camera
    this.cameras.main.setBounds(0,-200000,GW,200000+GH);
    this.cameras.main.startFollow(this.player,true,0.08,0.08);
    this.cameras.main.setFollowOffset(0,GH*0.22);

    // Input
    this.keys={};
    if(this.input.keyboard){
      this.keys.left =this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT);
      this.keys.right=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT);
      this.keys.a    =this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
      this.keys.d    =this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
      this.input.keyboard.on('keydown-SPACE',this.jump,this);
      this.input.keyboard.on('keydown-UP',   this.jump,this);
      this.input.keyboard.on('keydown-W',    this.jump,this);
    }
    this.touchLeft=false; this.touchRight=false;
    this.input.on('pointerdown',(ptr)=>{ if(ptr.y<GH*0.72) this.jump(); });

    const isMobile=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)||('ontouchstart' in window);
    if(isMobile){
      document.getElementById('touch-controls').style.display='block';
      document.getElementById('jump-hint').style.display='block';
    }
    const setL=(v)=>{ this.touchLeft=v; document.getElementById('btn-left').classList.toggle('pressed',v); };
    const setR=(v)=>{ this.touchRight=v; document.getElementById('btn-right').classList.toggle('pressed',v); };
    const zL=document.getElementById('zone-left');
    const zR=document.getElementById('zone-right');
    ['touchstart','touchend','touchcancel'].forEach(ev=>{
      zL.addEventListener(ev,(e)=>{ e.preventDefault(); setL(ev==='touchstart'); },{passive:false});
      zR.addEventListener(ev,(e)=>{ e.preventDefault(); setR(ev==='touchstart'); },{passive:false});
    });
    zL.addEventListener('touchmove',(e)=>e.preventDefault(),{passive:false});
    zR.addEventListener('touchmove',(e)=>e.preventDefault(),{passive:false});

    // Sub exit button
    document.getElementById('sub-exit-btn').onclick=()=>{ if(this.subActive) this.exitSub(); };

    document.getElementById('score-display').style.display='block';
    document.getElementById('powerup-bar').style.display='block';
  }

  addPlat(x,y,w){
    const key=this.makePlatTex(w);
    const p=this.platforms.create(x,y,key);
    p.setImmovable(true); p.refreshBody(); return p;
  }

  /* ‚îÄ‚îÄ Spawn obstacles / pickups ‚îÄ‚îÄ */
  maybeSpawnObstacle(worldY){
    if(worldY<this.lastObstacleY-Phaser.Math.Between(300,500)){
      this.lastObstacleY=worldY;
      const type=Phaser.Math.RND.pick(['bat','bat','boulder']);
      const x=Phaser.Math.Between(30,GW-30);
      const obs=this.obstacles.create(x,worldY,type);
      obs.obsType=type;
      obs.setDepth(9).setGravityY(-600); // float
      obs.body.allowGravity=false;
      if(type==='bat'){
        // bat moves horizontally, bouncing
        obs.setVelocityX(Phaser.Math.RND.pick([-130,-100,100,130]));
        obs.bobPhase=Math.random()*Math.PI*2;
        obs.bobAmp=Phaser.Math.Between(30,60);
        obs.originY=worldY;
      } else {
        // boulder falls slowly and rotates
        obs.body.allowGravity=true;
        obs.body.setGravityY(-500); // net slow fall
        obs.setAngularVelocity(120);
      }
    }
  }

  maybeSpawnPickup(worldY){
    if(worldY<this.lastPickupY-Phaser.Math.Between(400,700)){
      this.lastPickupY=worldY;
      const type=Phaser.Math.RND.pick(['pickup_wing','pickup_gem','pickup_gem','pickup_gem']);
      const x=Phaser.Math.Between(30,GW-30);
      const pk=this.pickups.create(x,worldY,type);
      pk.pkType=type;
      pk.setDepth(9);
      pk.body.allowGravity=false;
      pk.floatPhase=Math.random()*Math.PI*2;
      pk.originY=worldY;
    }
  }

  maybeSpawnSub(worldY){
    if(worldY<this.lastSubY-Phaser.Math.Between(1200,2000)){
      this.lastSubY=worldY;
      const x=Phaser.Math.Between(40,GW-40);
      const pk=this.pickups.create(x,worldY,'submarine');
      pk.pkType='submarine';
      pk.setDepth(9);
      pk.body.allowGravity=false;
      pk.floatPhase=Math.random()*Math.PI*2;
      pk.originY=worldY;
    }
  }

  /* ‚îÄ‚îÄ Obstacle hit ‚îÄ‚îÄ */
  hitObstacle(obs){
    if(this.stunTimer>0||this.subActive) return;
    this.stunTimer=1200; // 1.2s stun
    // Knockback
    const dir=this.player.x<obs.x?-1:1;
    this.player.body.setVelocityX(dir*400);
    this.player.body.setVelocityY(-300);
    // Visual flash
    this.cameras.main.shake(200,0.012);
    this.player.setTint(0xff4444);
    this.time.delayedCall(400,()=>{ this.player.clearTint(); });
    showFloatText(this,this.player.x,this.player.y,'üí•',0xff4400);
  }

  /* ‚îÄ‚îÄ Collect pickup ‚îÄ‚îÄ */
  collectPickup(pk){
    const type=pk.pkType;
    pk.destroy();
    if(type==='pickup_wing'){
      this.wingActive=true; this.wingTimer=this.WING_DUR;
      this.player.body.setGravityY(0);
      this.player.body.maxVelocity.y=200;
      document.getElementById('wing-bar').style.display='flex';
      showFloatText(this,this.player.x,this.player.y,'ü™∂ FLY!',0x00ccff);
    } else if(type==='pickup_gem'){
      this.score+=50;
      document.getElementById('score-value').textContent=this.score;
      showFloatText(this,this.player.x,this.player.y,'+50',0xffd700);
    } else if(type==='submarine'){
      this.enterSub();
    }
  }

  /* ‚îÄ‚îÄ Enter submarine capsule ‚îÄ‚îÄ */
  enterSub(){
    if(this.subActive) return;
    this.subActive=true; this.subTimer=this.SUB_DUR;
    this.player.setTexture('player_sub');
    this.player.body.setGravityY(0);
    this.player.body.maxVelocity.y=300;
    document.getElementById('sub-bar').style.display='flex';
    document.getElementById('sub-hud').style.display='block';
    document.getElementById('sub-flash').style.background='rgba(0,255,180,0.15)';
    showFloatText(this,this.player.x,this.player.y,'üöÄ CAPSULE!',0x00ffcc);
  }

  /* ‚îÄ‚îÄ Exit submarine ‚îÄ‚îÄ */
  exitSub(autoEject=false){
    this.subActive=false;
    this.player.setTexture(this.wingActive?'player_wing':'player');
    this.player.body.setGravityY(600);
    this.player.body.maxVelocity.y=1000;
    document.getElementById('sub-bar').style.display='none';
    document.getElementById('sub-hud').style.display='none';
    document.getElementById('sub-fill').style.width='0%';
    document.getElementById('sub-flash').style.background='rgba(0,255,180,0)';

    // Launch upward to nearest platform above
    this.player.body.setVelocityY(-900);
    showFloatText(this,this.player.x,this.player.y,autoEject?'‚ö†Ô∏è O‚ÇÇ OUT!':'üöÄ EJECTED!',0x00ffcc);
  }

  jump(){
    if(!this.alive) return;
    if(this.subActive) return; // inside sub: no manual jump
    if(this.wingActive){
      // Wings: can jump anytime (free fly)
      this.player.body.setVelocityY(-500);
      return;
    }
    if(this.player.body.blocked.down||this.player.body.touching.down){
      this.player.body.setVelocityY(-860);
    }
  }

  /* ‚îÄ‚îÄ update ‚îÄ‚îÄ */
  update(time,delta){
    if(!this.alive) return;
    const dt=delta/1000;

    // Stun countdown
    if(this.stunTimer>0) this.stunTimer-=delta;

    // ‚îÄ‚îÄ Movement (disabled when stunned inside sub) ‚îÄ‚îÄ
    if(!this.subActive){
      const MOVE_SPD=this.wingActive?260:320;
      const goLeft =this.touchLeft||(this.keys.left&&this.keys.left.isDown)||(this.keys.a&&this.keys.a.isDown);
      const goRight=this.touchRight||(this.keys.right&&this.keys.right.isDown)||(this.keys.d&&this.keys.d.isDown);
      if(goLeft&&!goRight){
        this.player.body.setVelocityX(-MOVE_SPD); this.player.setFlipX(true);
      } else if(goRight&&!goLeft){
        this.player.body.setVelocityX(MOVE_SPD); this.player.setFlipX(false);
      } else {
        this.player.body.setVelocityX(this.player.body.velocity.x*0.75);
      }
    } else {
      // Inside sub: ride with lava (hover just above lava)
      const targetY=this.lavaWorldY-80;
      const diff=targetY-this.player.y;
      this.player.body.setVelocityY(diff*3);
      this.player.body.setVelocityX(this.player.body.velocity.x*0.85);
    }

    // ‚îÄ‚îÄ Wing power-up timer ‚îÄ‚îÄ
    if(this.wingActive){
      this.wingTimer-=delta;
      const pct=Math.max(0,this.wingTimer/this.WING_DUR)*100;
      document.getElementById('wing-fill').style.width=pct+'%';
      if(this.wingTimer<=0){
        this.wingActive=false;
        this.player.setTexture('player');
        this.player.body.setGravityY(600);
        this.player.body.maxVelocity.y=1000;
        document.getElementById('wing-bar').style.display='none';
      }
    }

    // ‚îÄ‚îÄ Submarine oxygen timer ‚îÄ‚îÄ
    if(this.subActive){
      this.subTimer-=delta;
      const pct=Math.max(0,this.subTimer/this.SUB_DUR)*100;
      document.getElementById('sub-fill').style.width=pct+'%';
      // Oxygen bubbles indicator
      const dots=Math.ceil(pct/20);
      document.getElementById('sub-oxygen').textContent='‚¨§'.repeat(dots)+'‚óã'.repeat(5-dots)+' O‚ÇÇ';
      if(this.subTimer<=0) this.exitSub(true);
    }

    // ‚îÄ‚îÄ Lava ‚îÄ‚îÄ
    const boost=Math.min(this.score/45,4)*14;
    this.lavaWorldY-=(this.lavaSpd+boost)*dt;
    this.lavaWave+=dt*2.2;
    this.drawLava();

    // ‚îÄ‚îÄ Score ‚îÄ‚îÄ
    const h=Math.max(0,Math.floor((GH-this.player.y)/10));
    if(h>this.score){ this.score=h; document.getElementById('score-value').textContent=this.score; }

    // ‚îÄ‚îÄ Camera top for spawning ‚îÄ‚îÄ
    const camTop=this.cameras.main.scrollY;
    const playerWorldY=this.player.y;

    // ‚îÄ‚îÄ Spawn platforms ‚îÄ‚îÄ
    while(this.highestY>camTop-400){
      this.highestY-=Phaser.Math.Between(80,158);
      this.addPlat(Phaser.Math.Between(48,GW-48),this.highestY,Phaser.Math.Between(60,135));
    }

    // ‚îÄ‚îÄ Spawn obstacles/pickups based on player height ‚îÄ‚îÄ
    this.maybeSpawnObstacle(playerWorldY-GH*0.8);
    this.maybeSpawnPickup(playerWorldY-GH*0.7);
    this.maybeSpawnSub(playerWorldY-GH*0.9);

    // ‚îÄ‚îÄ Animate obstacles ‚îÄ‚îÄ
    this.obstacles.getChildren().forEach(obs=>{
      if(obs.obsType==='bat'){
        // Bob up/down
        obs.bobPhase=(obs.bobPhase||0)+dt*2.5;
        obs.y=obs.originY+Math.sin(obs.bobPhase)*obs.bobAmp;
        // Bounce off walls
        if(obs.x<20||obs.x>GW-20) obs.setVelocityX(-obs.body.velocity.x);
        // Flip sprite
        obs.setFlipX(obs.body.velocity.x<0);
      }
      // Remove if far below lava
      if(obs.y>this.lavaWorldY+300) obs.destroy();
    });

    // ‚îÄ‚îÄ Animate pickups (float) ‚îÄ‚îÄ
    this.pickups.getChildren().forEach(pk=>{
      pk.floatPhase=(pk.floatPhase||0)+dt*2;
      pk.y=pk.originY+Math.sin(pk.floatPhase)*8;
      pk.rotation+=dt*1.5;
      if(pk.y>this.lavaWorldY+200) pk.destroy();
    });

    // ‚îÄ‚îÄ Remove far platforms ‚îÄ‚îÄ
    this.platforms.getChildren().forEach(p=>{ if(p.y>this.lavaWorldY+260) p.destroy(); });

    // ‚îÄ‚îÄ Death ‚îÄ‚îÄ
    if(!this.subActive && this.player.y>this.lavaWorldY){ this.die(); return; }

    // ‚îÄ‚îÄ Danger flash ‚îÄ‚îÄ
    const dist=this.lavaWorldY-this.player.y;
    const fa=(!this.subActive&&dist<280)?(1-dist/280)*0.28:0;
    document.getElementById('danger-flash').style.background=`rgba(255,40,0,${fa.toFixed(3)})`;

    // ‚îÄ‚îÄ Embers ‚îÄ‚îÄ
    this.emberTimer-=delta;
    if(this.emberTimer<0){
      this.emberTimer=Phaser.Math.Between(70,190);
      const lsy=this.lavaWorldY-this.cameras.main.scrollY;
      this.embers.push({
        x:Phaser.Math.Between(0,GW),y:lsy,
        vx:Phaser.Math.FloatBetween(-38,38),
        vy:Phaser.Math.FloatBetween(-150,-250),
        life:1,size:Phaser.Math.FloatBetween(2,5),
        col:Phaser.Math.RND.pick([0xff6600,0xff3300,0xffaa00]),
      });
    }
    this.emberGfx.clear();
    this.embers=this.embers.filter(e=>{
      e.x+=e.vx*dt; e.y+=e.vy*dt; e.vy+=105*dt; e.life-=dt*1.3;
      if(e.life<=0) return false;
      this.emberGfx.fillStyle(e.col,Math.min(e.life*0.88,0.92));
      this.emberGfx.fillCircle(e.x,e.y,e.size*e.life);
      return true;
    });

    // ‚îÄ‚îÄ Wall wrap ‚îÄ‚îÄ
    if(this.player.x<-15) this.player.x=GW+15;
    if(this.player.x>GW+15) this.player.x=-15;

    // ‚îÄ‚îÄ Squash/stretch ‚îÄ‚îÄ
    if(!this.subActive){
      const vy=this.player.body.velocity.y;
      if(vy<-130) this.player.setScale(0.87,1.18);
      else if(vy>130) this.player.setScale(1.12,0.88);
      else this.player.setScale(1,1);
    } else {
      this.player.setScale(1,1);
    }
  }

  drawLava(){
    const g=this.lavaGfx; g.clear();
    const sy=this.lavaWorldY-this.cameras.main.scrollY;
    g.fillGradientStyle(0xff1a00,0xff2200,0xaa0000,0x880000,1);
    g.fillRect(0,sy+20,GW,GH-sy+60);
    for(let x=0;x<=GW;x+=5){
      const wh=Math.sin(x*0.045+this.lavaWave)*11+11;
      g.fillStyle(0xff4d00,1); g.fillRect(x,sy+8-wh,5,wh+12);
    }
    for(let x=0;x<=GW;x+=5){
      const wh=Math.sin(x*0.045+this.lavaWave)*11+3;
      g.fillStyle(0xffaa00,0.8); g.fillRect(x,sy+6-wh,5,3);
    }
    g.fillStyle(0xffdd00,0.22);
    for(let i=0;i<6;i++){
      const gx=((i*73+this.lavaWave*28)%GW);
      g.fillCircle(gx,sy+30,22);
    }
  }

  die(){
    if(!this.alive) return;
    this.alive=false;
    // cleanup UI
    document.getElementById('wing-bar').style.display='none';
    document.getElementById('sub-bar').style.display='none';
    document.getElementById('sub-hud').style.display='none';
    document.getElementById('sub-flash').style.background='rgba(0,255,180,0)';
    document.getElementById('danger-flash').style.background='rgba(255,40,0,0.6)';
    setTimeout(()=>{ document.getElementById('danger-flash').style.background='rgba(255,40,0,0)'; },600);
    if(this.score>bestScore) bestScore=this.score;
    document.getElementById('final-score').textContent=this.score;
    document.getElementById('best-score').textContent=bestScore;
    document.getElementById('score-display').style.display='none';
    document.getElementById('powerup-bar').style.display='none';
    setTimeout(()=>{ document.getElementById('gameover-screen').style.display='flex'; },400);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Config ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const cfg={
  type:Phaser.AUTO, width:GW, height:GH, parent:'game-container',
  backgroundColor:'#0a0005',
  physics:{default:'arcade',arcade:{gravity:{y:0},debug:false}},
  scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},
  scene:[GameScene],
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UI Control ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function startGame(){
  ['menu-screen','gameover-screen'].forEach(id=>{ document.getElementById(id).style.display='none'; });
  document.getElementById('score-display').style.display='none';
  document.getElementById('powerup-bar').style.display='none';
  document.getElementById('danger-flash').style.background='rgba(255,40,0,0)';
  document.getElementById('sub-flash').style.background='rgba(0,255,180,0)';
  document.getElementById('btn-left').classList.remove('pressed');
  document.getElementById('btn-right').classList.remove('pressed');
  gameStarted=true; playBGM();
  if(!phaserGame){ phaserGame=new Phaser.Game(cfg); }
  else { phaserGame.scene.stop('GameScene'); phaserGame.scene.start('GameScene'); }
}
document.getElementById('start-btn').addEventListener('click',startGame);
document.getElementById('retry-btn').addEventListener('click',startGame);
document.getElementById('menu-btn-go').addEventListener('click',()=>{
  document.getElementById('gameover-screen').style.display='none';
  document.getElementById('menu-screen').style.display='flex';
  document.getElementById('score-display').style.display='none';
  document.getElementById('powerup-bar').style.display='none';
  document.getElementById('danger-flash').style.background='rgba(255,40,0,0)';
  document.getElementById('sub-flash').style.background='rgba(0,255,180,0)';
  gameStarted=false;
  if(phaserGame) phaserGame.scene.stop('GameScene');
  stopBGM();
});
</script>
</body>
</html>
