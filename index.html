<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ç«å±±è·³èº | Volcano Jump</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{background:#0a0005;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;font-family:'Cinzel',serif;}
#game-container{position:relative;width:420px;height:748px;}
canvas{display:block;}

#ui-overlay{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:10;}

/* HUD */
#score-display{position:absolute;top:10px;left:16px;display:none;pointer-events:none;}
#score-label{color:rgba(255,160,80,.6);font-size:9px;letter-spacing:3px;}
#score-value{color:#ffd700;font-family:'Cinzel Decorative',cursive;font-size:26px;font-weight:900;}

#lang-btn{position:absolute;top:10px;right:12px;pointer-events:all;
  background:linear-gradient(145deg,#1c0500,#4a1000);border:2px solid #ff6b00;color:#ffd700;
  padding:6px 14px;border-radius:30px;cursor:pointer;z-index:100;}

/* é“å…·æ¬„ */
#item-bar{position:absolute;bottom:210px;left:50%;transform:translateX(-50%);
  display:none;pointer-events:all;flex-direction:row;gap:8px;
  background:rgba(0,0,0,0.6);border:1px solid rgba(255,120,0,0.4);
  border-radius:16px;padding:6px 10px;backdrop-filter:blur(5px);}
.item-slot{width:48px;height:48px;border-radius:10px;cursor:pointer;
  background:rgba(20,5,0,0.7);border:2px solid rgba(255,100,0,0.3);
  display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;}
.item-slot.selected{border-color:#00ffcc;box-shadow:0 0 15px rgba(0,255,180,0.5);}
.item-emoji{font-size:22px;}
.item-label{font-size:7px;color:#ffcc88;}

/* æ§åˆ¶æŒ‰éˆ• */
#controls{position:absolute;bottom:0;left:0;right:0;height:220px;display:none;pointer-events:none;}
.dpad-btn, #btn-jump, #btn-use{pointer-events:all;user-select:none;}
#dpad{position:absolute;bottom:30px;left:20px;width:150px;height:150px;}
.dpad-btn{position:absolute;width:55px;height:55px;background:rgba(80,20,0,0.6);border:2px solid #ff6b00;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#ffd700;font-size:24px;}
#btn-up{left:50px;top:0;}
#btn-left2{left:0;top:60px;}
#btn-right2{right:100px;top:60px;} /* ä¿®æ­£é‡ç–Šå•é¡Œ */

#right-btns{position:absolute;bottom:30px;right:20px;width:130px;height:150px;}
#btn-jump{position:absolute;top:0;right:0;width:85px;height:85px;border-radius:50%;background:linear-gradient(145deg,#8b2200,#4a1000);border:3px solid #ff8800;color:#ff8800;display:flex;align-items:center;justify-content:center;font-weight:900;box-shadow:0 5px 15px rgba(0,0,0,0.5);}
#btn-use{position:absolute;bottom:0;left:0;width:75px;height:75px;border-radius:50%;background:linear-gradient(145deg,#004433,#002211);border:3px solid #00ffcc;display:flex;flex-direction:column;align-items:center;justify-content:center;}

/* è¢å¹•ç‰¹æ•ˆ */
#danger-flash{position:absolute;inset:0;pointer-events:none;z-index:5;}

/* é¸å–®èˆ‡çµç®— */
#menu-screen, #gameover-screen{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);z-index:200;pointer-events:all;}
.luxury-btn{background:linear-gradient(160deg,#8b2200,#2a0500);padding:16px 50px;border-radius:50px;border:2px solid #ffd700;color:#ffd700;cursor:pointer;font-family:'Cinzel Decorative';font-size:20px;letter-spacing:2px;box-shadow:0 0 20px rgba(255,100,0,0.4);}
</style>
</head>
<body>
<div id="game-container">
  <div id="ui-overlay">
    <div id="score-display"><div id="score-label">HEIGHT</div><div id="score-value">0</div></div>
    <button id="lang-btn">EN / ä¸­</button>
    <div id="danger-flash"></div>
    <div id="item-bar"></div>

    <div id="controls">
      <div id="dpad">
        <div class="dpad-btn" id="btn-up">â–²</div>
        <div class="dpad-btn" id="btn-left2">â—€</div>
        <div class="dpad-btn" id="btn-right2">â–¶</div>
      </div>
      <div id="right-btns">
        <div id="btn-jump">JUMP</div>
        <div id="btn-use"><span id="btn-use-icon" style="font-size:24px">ğŸ’</span><span style="font-size:10px;color:#00ffcc">USE</span></div>
      </div>
    </div>

    <div id="menu-screen">
      <h1 style="color:#ffd700;font-size:42px;text-shadow:0 0 20px #ff6600;margin-bottom:30px;text-align:center;">VOLCANO<br>JUMP</h1>
      <button class="luxury-btn" id="start-btn">PLAY</button>
    </div>

    <div id="gameover-screen" style="display:none">
      <h2 style="color:#ff3300;margin-bottom:10px;">CONSUMED</h2>
      <div style="color:#ffd700;font-size:50px;margin-bottom:20px;" id="final-score">0</div>
      <button class="luxury-btn" id="retry-btn">RISE AGAIN</button>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â• å…¨åŸŸå®£å‘Š â•â•â•â•â•â•â• */
var inventory = [];
var selectedSlot = 0;
var phaserGame = null;
const ITEM_INFO = {
  wing: { emoji: 'ğŸª¶', label: 'WINGS' },
  sub:  { emoji: 'ğŸš€', label: 'CAPSULE' },
  drill:{ emoji: 'ğŸ”©', label: 'DRILL' },
  sword:{ emoji: 'âš”ï¸', label: 'SWORD' }
};

function renderItemBar() {
  const bar = document.getElementById('item-bar');
  bar.innerHTML = '';
  if (inventory.length === 0) { bar.style.display = 'none'; return; }
  bar.style.display = 'flex';
  inventory.forEach((item, i) => {
    const slot = document.createElement('div');
    slot.className = 'item-slot' + (i === selectedSlot ? ' selected' : '');
    slot.innerHTML = `<span class="item-emoji">${ITEM_INFO[item.type].emoji}</span><span class="item-label">${ITEM_INFO[item.type].label}</span>`;
    slot.onclick = (e) => { e.stopPropagation(); selectedSlot = i; renderItemBar(); };
    bar.appendChild(slot);
  });
}

/* â•â•â•â•â•â•â• éŠæˆ²å ´æ™¯ â•â•â•â•â•â•â• */
class MainScene extends Phaser.Scene {
  constructor() { super('MainScene'); }
  
  create() {
    this.score = 0;
    this.alive = true;
    this.lavaY = 800;
    this.platforms = this.physics.add.staticGroup();
    
    // ç”Ÿæˆåˆå§‹å¹³å°
    for(let i=0; i<15; i++) {
        let x = Phaser.Math.Between(50, 370);
        let y = 700 - (i * 120);
        this.platforms.create(x, y, 'plat');
    }

    this.player = this.physics.add.sprite(210, 600, 'hero');
    this.player.setCollideWorldBounds(false);
    this.physics.add.collider(this.player, this.platforms, (p, plat) => {
        if(p.body.touching.down) p.setVelocityY(-550);
    });

    this.cameras.main.startFollow(this.player, true, 0, 0.1, 0, 150);
    this.lavaGfx = this.add.graphics().setDepth(5);
    
    // æ§åˆ¶ç¶å®š
    this.cursors = this.input.keyboard.createCursorKeys();
    this.setupTouchControls();
  }

  setupTouchControls() {
    this.moveL = false; this.moveR = false;
    document.getElementById('btn-left2').onpointerdown = () => this.moveL = true;
    document.getElementById('btn-left2').onpointerup = () => this.moveL = false;
    document.getElementById('btn-right2').onpointerdown = () => this.moveR = true;
    document.getElementById('btn-right2').onpointerup = () => this.moveR = false;
    document.getElementById('btn-jump').onpointerdown = () => { if(this.player.body.touching.down) this.player.setVelocityY(-700); };
  }

  update() {
    if(!this.alive) return;
    
    // ç§»å‹•é‚è¼¯
    if(this.moveL || this.cursors.left.isDown) this.player.setVelocityX(-250);
    else if(this.moveR || this.cursors.right.isDown) this.player.setVelocityX(250);
    else this.player.setVelocityX(0);

    // å²©æ¼¿ä¸Šå‡
    this.lavaY -= 0.8 + (this.score / 500);
    this.drawLava();

    // è¨ˆåˆ†
    let dist = Math.floor((600 - this.player.y) / 10);
    if(dist > this.score) {
        this.score = dist;
        document.getElementById('score-value').textContent = this.score;
    }

    // æ­»äº¡åˆ¤å®š
    if(this.player.y > this.lavaY) this.gameOver();
  }

  drawLava() {
    this.lavaGfx.clear();
    this.lavaGfx.fillStyle(0xff4400, 0.8);
    let screenLavaY = this.lavaY - this.cameras.main.scrollY;
    this.lavaGfx.fillRect(0, screenLavaY, 420, 1000);
    
    // å±æ©Ÿé–ƒçˆ
    let dist = this.lavaY - this.player.y;
    let alpha = Phaser.Math.Clamp(1 - (dist / 300), 0, 0.6);
    document.getElementById('danger-flash').style.background = `rgba(255,0,0,${alpha})`;
  }

  gameOver() {
    this.alive = false;
    document.getElementById('final-score').textContent = this.score;
    document.getElementById('gameover-screen').style.display = 'flex';
    document.getElementById('controls').style.display = 'none';
  }
}

// é è¼‰å ´æ™¯ (ç”Ÿæˆæè³ªé˜²æ­¢é»‘å±)
class BootScene extends Phaser.Scene {
    constructor() { super('BootScene'); }
    create() {
        // ç”Ÿæˆè‹±é›„æè³ª
        let g = this.make.graphics({add:false});
        g.fillStyle(0xffaa00); g.fillCircle(15, 15, 15);
        g.generateTexture('hero', 30, 30);
        // ç”Ÿæˆå¹³å°æè³ª
        g.clear(); g.fillStyle(0x884422); g.fillRoundedRect(0, 0, 80, 15, 5);
        g.generateTexture('plat', 80, 15);
        this.scene.start('MainScene');
    }
}

const cfg = {
  type: Phaser.AUTO, width: 420, height: 748,
  parent: 'game-container',
  physics: { default: 'arcade', arcade: { gravity: { y: 1000 } } },
  scene: [BootScene, MainScene]
};

document.getElementById('start-btn').onclick = () => {
    document.getElementById('menu-screen').style.display = 'none';
    document.getElementById('score-display').style.display = 'block';
    document.getElementById('controls').style.display = 'block';
    if(!phaserGame) phaserGame = new Phaser.Game(cfg);
    else phaserGame.scene.start('BootScene');
};

document.getElementById('retry-btn').onclick = () => {
    document.getElementById('gameover-screen').style.display = 'none';
    document.getElementById('controls').style.display = 'block';
    phaserGame.scene.start('BootScene');
};
</script>
</body>
</html>
